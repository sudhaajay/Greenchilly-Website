<%- include('../Layout/adminHeader.ejs') %>

<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Dashboard </h2>
            <p>Whole data about your business here</p>
        </div>
        <div>
            <a href="/admin/salesReport"class="btn btn-primary"><i class="text-muted material-icons md-post_add"></i>Create report</a>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-4">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons md-monetization_on"></i></span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Revenue</h6>
                        <span>₹<%= totalRevenue %></span>
                        <span class="text-sm">
                            Total Revenue.
                        </span>
                    </div>
                </article>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Orders</h6> <span><%= totalOrders %></span>
                        <span class="text-sm">
                            Total number of orders.
                        </span>
                    </div>
                </article>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-qr_code"></i></span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Products</h6> <span><%= totalProducts %></span>
                        <span class="text-sm">
                            In <%= totalCategories %> Categories
                        </span>
                    </div>
                </article>
            </div>
        </div>
    </div>


    <div class="row">

        <div class="col-lg-4">
            <div class="card card-body mb-4">
                <article class="icontext">
                    <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-shopping_basket"></i></span>
                    <div class="text">
                        <h6 class="mb-1 card-title">Total Active Users</h6> <span>&nbsp; <%= totalUsers %></span>
                        <span class="text-sm">
                            All the active users.
                        </span>
                    </div>
                </article>
            </div>
        </div>
   

      <div class="col-lg-4">
        <div class="card card-body mb-4">
            <article class="icontext">
                <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-qr_code"></i></span>
                <div class="text">
                    <h6 class="mb-1 card-title">Total Categories</h6> <span>&nbsp; <%= totalCategories %></span>
                    <span class="text-sm">
                      In <%= totalCategories %> Categories
                  </span>
                </div>
            </article>
        </div>
      </div>
     <div class="col-lg-4">
      <div class="card card-body mb-4">
          <article class="icontext">
              <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-shopping_basket"></i></span>
              <div class="text">
                  <h6 class="mb-1 card-title">Monthly earning</h6> <span>₹&nbsp; <%= monthlyEarningsValue %></span>
                  <span class="text-sm">
                      Total monthly earning.
                  </span>
              </div>
          </article>
       </div>
     </div>
  </div>
    
    <div class="row">
        <div class="col-xl-12 col-lg-8">
            <div class="card mb-4">
                <article class="card-body">
                    <h5 class="card-title">Sale statistics</h5>
                    <input type="hidden" value="<%= dailyOrderCounts %>" id="dailyOrderArray" />
                    <input type="hidden" value="<%= monthlyOrderCounts %>" id="monthlySalesArray" />
                    <input type="hidden" value="<%= yearlyOrderCounts %>" id="yearlyOrderCounts" />
            
                    <button class="btn btn-xs btn btn-sm btn-light font-xs rounded">Weekly</button>
                    <button class="btn btn-sm btn-light font-xs rounded">Monthly</button>
                    <button class="btn btn-sm btn-light font-xs rounded">Yearly</button>
            
                    
                    <canvas id="myChartWeekly" height="120px" style="display: none;"></canvas>
                    <canvas id="myChartMonthly" height="120px" style="display: none;"></canvas>
                    <canvas id="myChartYearly" height="120px" style="display: none;"></canvas>
                </article>
            </div>
            
            
            <div class="row">
                <div class="col-lg-3">
                    <div class="card mb-5" style="height: 400px; overflow-y: scroll;">
                        <article class="card-body">
                            <h5 class="card-title">New Members</h5>
                            <div class="new-member-list">
                                <% newUsers.forEach((user) => { %>

                                <div class="d-flex align-items-center justify-content-between mb-4">
                                    <div class="d-flex align-items-center">
                                        <img src="/userassets/imgs/user/<%= user.image %>" alt="" class="avatar">
                                        <div>
                                            <h6><%= user.name %></h6>
                                            <!-- <p class="text-muted font-xs">
                                                Sanfrancisco
                                            </p> -->
                                        </div>
                                    </div>
                                    <span class="badge badge-pill badge-soft-success">Active</span>                            </div>
                                    <% }); %>
                  </div>
              </article>
          </div>
      </div>
                    <div class="col-lg-3">
                        <div class="card mb-5" style="height: 400px; overflow-y: scroll;">
                            <article class="card-body">
                                <h5 class="card-title">Top 10 Products</h5>
                                <div class="new-member-list">
                                    <% topProducts.forEach((product) => { %>

                                    <div class="d-flex align-items-center justify-content-between mb-4">
                                        <div class="d-flex align-items-center">
                                            <img src="/assets/imgs/productIMG/<%= product.product.image[0] %>" alt="" class="avatar">
                                            <div>
                                                <h6><%= product.product.name %></h6>
                                                <!-- <p class="text-muted font-xs">
                                                    Sanfrancisco
                                                </p> -->
                                            </div>
                                        </div>
                                        <span class="badge badge-pill badge-soft-success"><%= product.orderCount %></span>                            </div>
                                        <% }); %>
                    </div>
                </article>
                </div>
                </div>
                <div class="col-lg-3">
                    <div class="card mb-5" style="height: 400px; overflow-y: scroll;">
                        <article class="card-body">
                            <h5 class="card-title">Top 10 categories</h5>
                            <div class="new-member-list">
                                <% topCategories.forEach((cat) => { %>

                                <div class="d-flex align-items-center justify-content-between mb-4">
                                    <div class="d-flex align-items-center">
                                        <div>
                                            <h6><%= cat.categoryName %></h6>
                                            <!-- <p class="text-muted font-xs">
                                                Sanfrancisco
                                            </p> -->
                                        </div>
                                    </div>
                                    <span class="badge badge-pill badge-soft-success"><%= cat.orderCount %></span>                            </div>
                                    <% }); %>
                </div>
                </article>
                </div>
                </div>
                <div class="col-lg-3">
                    <div class="card mb-5 " style="height: 400px; overflow-y: scroll;">
                        <article class="card-body">
                            <h5 class="card-title">Top Brands</h5>
                            <div class="new-member-list">
                                <% topBrands.forEach((brand) => { %>

                                <div class="d-flex align-items-center justify-content-between mb-4">
                                    <div class="d-flex align-items-center">
                                        <div>
                                            <h6><%= brand._id %></h6>
                                            <!-- <p class="text-muted font-xs">
                                                Sanfrancisco
                                            </p> -->
                                        </div>
                                    </div>
                                    <span class="badge badge-pill badge-soft-success"><%= brand.orderCount %></span>                            </div>
                                    <% }); %>
                </div>
                </article>
                </div>
                </div>
  </div> 
</div>


<div class="card mb-4">
  <header class="card-header">
      <h4 class="card-title">Latest orders</h4>
      
  </header>
  <div class="card-body">
      <div class="table-responsive">
          <div class="table-responsive">
        <table class="table align-middle table-nowrap mb-0"> 
                  <table id="products" class="table align-middle table-nowrap mb-0">
                      <thead>
                        <tr>
                          <th scope="col">Order Id</th>
                          <th scope="col">Billing Name</th>
                          <th scope="col">Ordered Date</th>
                          <th scope="col">Delivery Date</th>
                          <th scope="col">Total</th>
                         
                        </tr>
                      </thead>
                      <tbody>
                          
                          <% orders.forEach((order) => { %>
                            <tr>                    
                                <td><%= order._id %></td>
                                <% if (order.user) { %>
                                    <td><%= order.user.name %></td>
                                <% } else { %>
                                    <td>User Not Available</td>
                                <% } %>
                                <td><%= new Date(order.orderDate).toLocaleDateString() %></td>
                                <td> <%= new Date(order.deliveryDate).toLocaleDateString() %></td>
                                <td><%= order.totalAmount %></td>
                            </tr>
                              <% }); %>
                      </tbody>
                  </table>
          </div>
      </div> <!-- table-responsive end// -->
  </div>
</div>
  
</section> <!-- content-main end// -->

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
      (function ($) {
          "use strict";
  
          // Display weekly chart by default when page loads
          $(document).ready(function() {
              displayChart('Weekly');
          });
  
          // Event listeners for buttons
          $('.btn').click(function() {
              const chartType = $(this).text().trim();
              displayChart(chartType);
          });
  
          function displayChart(chartType) {
              // Hide all charts by default
              hideChart('myChartWeekly');
              hideChart('myChartMonthly');
              hideChart('myChartYearly');
  
              if (chartType === 'Weekly') {
                  showChart('myChartWeekly');
                  drawWeeklyChart();
              } else if (chartType === 'Monthly') {
                  showChart('myChartMonthly');
                  drawMonthlyChart();
              } else if (chartType === 'Yearly') {
                  showChart('myChartYearly');
                  drawYearlyChart();
              }
          }
  
          function showChart(chartId) {
              $('#' + chartId).show();
          }
  
          function hideChart(chartId) {
              $('#' + chartId).hide();
          }
  
          function drawWeeklyChart() {
              let weeklyOrderArray = $('#weeklyOrderArray').val().split(",").map(Number);
  
              if ($('#myChartWeekly').length) {
                  var ctx = document.getElementById('myChartWeekly').getContext('2d');
                  var chart = new Chart(ctx, {
                      type: 'line',
                      data: {
                          labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                          datasets: [{
                              label: 'Weekly',
                              tension: 0.3,
                              fill: true,
                              backgroundColor: 'rgba(44, 120, 220, 0.2)',
                              borderColor: 'rgba(44, 120, 220)',
                              data: weeklyOrderArray
                          }]
                      },
                      options: {
                          plugins: {
                              legend: {
                                  labels: {
                                      usePointStyle: true
                                  }
                              }
                          }
                      }
                  });
              }
          }
  
          function drawMonthlyChart() {
              let monthlyOrderArray = $('#monthlyOrderArray').val().split(",").map(Number);
  
              if ($('#myChartMonthly').length) {
                  var ctx = document.getElementById('myChartMonthly').getContext('2d');
                  var chart = new Chart(ctx, {
                      type: 'line',
                      data: {
                          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                          datasets: [{
                              label: 'Monthly',
                              tension: 0.3,
                              fill: true,
                              backgroundColor: 'rgba(44, 120, 220, 0.2)',
                              borderColor: 'rgba(44, 120, 220)',
                              data: monthlyOrderArray
                          }]
                      },
                      options: {
                          plugins: {
                              legend: {
                                  labels: {
                                      usePointStyle: true
                                  }
                              }
                          }
                      }
                  });
              }
          }
  
          function drawYearlyChart() {
              let yearlyOrderArray = $('#yearlyOrderArray').val().split(",").map(Number);
  
              if ($('#myChartYearly').length) {
                  var ctx = document.getElementById('myChartYearly').getContext('2d');
                  var chart = new Chart(ctx, {
                      type: 'line',
                      data: {
                          labels: ['2020', '2021', '2022', '2023', '2024', '2025'], // Adjust labels as needed
                          datasets: [{
                              label: 'Yearly',
                              tension: 0.3,
                              fill: true,
                              backgroundColor: 'rgba(44, 120, 220, 0.2)',
                              borderColor: 'rgba(44, 120, 220)',
                              data: yearlyOrderArray
                          }]
                      },
                      options: {
                          plugins: {
                              legend: {
                                  labels: {
                                      usePointStyle: true
                                  }
                              }
                          }
                      }
                  });
              }
          }
      })(jQuery);
  </script>

    <%- include('../layout/adminFooter.ejs') %>
    <script src="/assets/js/vendors/chart.js"></script> 

    <script src="/assets/js/custom-chart.js" type="text/javascript"></script>

   

   
   

      
    
    
    
  
    
    
   
  







